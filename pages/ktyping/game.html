<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>KrazyType ‚Äî KGame</title>
  <link rel="stylesheet" href="https://unpkg.com/@picocss/pico@latest/css/pico.min.css">

  <style>
    html, body {
      height: 100%;
      margin: 0;
      display: flex;
      flex-direction: column;
    }

    main {
      flex: 1;
    }

    .container-narrow {
      max-width: 900px;
      margin: auto;
    }

    .game-box {
      background: var(--surface-2);
      border-radius: var(--border-radius);
      padding: 1.5rem;
      margin-top: 1rem;
    }

    textarea {
      font-family: monospace;
      resize: vertical;
    }

    .rules span {
      display: inline-block;
      margin-right: 1rem;
      font-weight: bold;
    }

    .timer {
      font-size: 1.2rem;
      font-weight: bold;
    }

    footer {
      text-align: center;
      border-top: 1px solid var(--surface-3);
      padding: 1rem;
    }
  </style>
</head>

<body>
<header class="container container-narrow">
  <nav>
    <ul>
      <li class="logo"><a href="/krazyplace">KrazyPlace</a></li>
      <li><a href="#">K-Typing</a></li>
    </ul>
  </nav>
</header>

<main class="container container-narrow">
  <section>
    <h1>‚å®Ô∏è KrazyType</h1>
    <p>R√©√©cris le texte le plus vite possible‚Ä¶ mais pas n'importe comment.</p>

    <div style="margin:1rem 0">
      <button id="dailyBtn">Partie du jour üåû</button>
      <button id="randomBtn">Partie al√©atoire üé≤</button>
    </div>

    <div id="game" class="game-box" style="display:none">
      <p class="timer">‚è±Ô∏è Temps : <span id="time">0.00</span>s</p>

      <h4>Texte √† r√©√©crire</h4>
      <blockquote id="targetText"></blockquote>

      <div class="rules">
        <span id="bannedRule"></span>
        <span id="swapRule"></span>
      </div>

      <textarea id="input" rows="5" placeholder="Commence √† taper ici‚Ä¶" disabled></textarea>

      <p id="status"></p>
    </div>

    <div id="end" class="game-box" style="display:none">
      <h2>üéâ Termin√© !</h2>
      <p>Temps final : <strong><span id="finalTime"></span>s</strong></p>
    </div>
  </section>
</main>

<footer>
  ¬© KrazyPlace
</footer>

<script>
/* === RNG d√©terministe === */
function pseudoRandom(seed) {
  let s = seed;
  return () => {
    s = (s * 16807) % 2147483647;
    return (s - 1) / 2147483646;
  };
}

const texts = [
  "Le renard brun rapide saute par dessus le chien paresseux",
  "Programmer est un art autant qu une science",
  "La curiosite est le moteur de la connaissance",
  "Les jeux de mots rendent les phrases amusantes"
];

let rng;
let bannedLetters = [];
let swap = {};
let startTime;
let timerInterval;

/* === D√©marrage === */
function startGame(seed) {
  rng = pseudoRandom(seed);

  const text = texts[Math.floor(rng() * texts.length)];
  document.getElementById("targetText").textContent = text;

  // lettres bannies
  const alphabet = "aeiou";
  bannedLetters = [alphabet[Math.floor(rng() * alphabet.length)]];
  document.getElementById("bannedRule").textContent =
    "üö´ Lettre interdite : " + bannedLetters.join(", ");

  // lettres interchang√©es
  const l1 = "a";
  const l2 = "e";
  swap = { [l1]: l2, [l2]: l1 };
  document.getElementById("swapRule").textContent =
    "üîÑ Lettres invers√©es : a ‚Üî e";

  document.getElementById("game").style.display = "block";
  document.getElementById("end").style.display = "none";

  const input = document.getElementById("input");
  input.value = "";
  input.disabled = false;
  input.focus();

  startTime = performance.now();
  timerInterval = setInterval(updateTimer, 50);
}

function updateTimer() {
  const t = (performance.now() - startTime) / 1000;
  document.getElementById("time").textContent = t.toFixed(2);
}

/* === Validation === */
document.getElementById("input").addEventListener("input", () => {
  const value = document.getElementById("input").value;
  const target = document.getElementById("targetText").textContent;

  // longueur incorrecte
  if (value.length !== target.length) return;

  for (let i = 0; i < target.length; i++) {
    let expected = target[i];

    if (swap[expected]) expected = swap[expected];
    if (bannedLetters.includes(target[i])) expected = "*";

    if (value[i] !== expected) return;
  }

  endGame();
});

function endGame() {
  clearInterval(timerInterval);
  document.getElementById("input").disabled = true;

  document.getElementById("game").style.display = "none";
  document.getElementById("end").style.display = "block";
  document.getElementById("finalTime").textContent =
    ((performance.now() - startTime) / 1000).toFixed(2);
}

/* === Modes === */
document.getElementById("dailyBtn").onclick = () => {
  const today = new Date().toISOString().split("T")[0];
  const seed = [...today].reduce((a, c) => a + c.charCodeAt(0), 0);
  startGame(seed);
};

document.getElementById("randomBtn").onclick = () => {
  startGame(Math.floor(Math.random() * 2147483647));
};
</script>
</body>
</html>
